---

- hosts: all
  gather_facts: false
  pre_tasks:
    - apt:
        name:  "{{ item }}"
        state: present
        install_recommends: false
        update_cache:       true
        cache_valid_time:   3600
      with_items:
        - nano
        - vim
  vars:
    manala_alternatives_selections:
      - selection: editor
        path:      /usr/bin/vim.basic
  roles:
    - manala.alternatives
  post_tasks:
    - raw: "{{ 'echo \"' ~ item|to_yaml ~ '\"|goss -g - validate' }}"
      with_items:
        - command:
            update-alternatives --query editor:
              exit-status: 0
              stdout:
                - "Value: /usr/bin/vim.basic"
